{
    "collab_server" : "",
    "contents" : "---\ntitle: 'Can Gender Quotas Imposed by Development Agencies Empower Women? Null Evidence from a Field Experiment in Congo'\nauthor: \"Authors: Anonymous\"\ndate: \"May 4, 2017\"\noutput:\n  html_document:\n    number_sections: yes\n    theme: united\n    toc: yes\n    toc_depth: 3\n  pdf_document:\n    number_sections: yes\n    toc: yes\n    toc_depth: 3\n---\n\n```{r setup, include=FALSE}\nrm(list=ls(all=TRUE)) \nknitr::opts_chunk$set(echo = TRUE)\n```\n\nThis .Rmd file replicates the core analysis as well as additional results from \"Can Gender Quotas Imposed by Development Agencies Empower Women? Null Evidence from a Field Experiment in Congo\". It is not necessary to download any data for this (select \"local_data<-LATE\" below and code downloads data directly from Dataverse\"). Code outputs table and figures in .tex format, which are used when creating the Latex file.\n\n# Replication Setup\n\n```{r, include = FALSE}\n\n  # Packages\n  # Possibly necessary installations:\n  # devtools::install_github(\"iqss/dataverse-client-r\")\n  # install.packages(\"rio\")\n\n  packages <- c(\"AER\", \"foreign\", \"dplyr\", \"car\", \"sandwich\", \"xtable\", \"knitr\", \"zoo\", \"dataverse\", \"triebeard\", \"rio\")\n  sapply(packages,library,character.only=TRUE)\n  \n  # Helper functions\n  source(\"R/0 helper  mean_effects.R\")\n  source(\"R/0 helper cluster_robust.R\")\n  source(\"R/0 helper latex_functions.R\")\n  \n```\n\n## Options\n\n\"local_data <- FALSE\" runs code based on data published online at Dataverse.\n```{r}\n\n # load data locally or from dataverse\n  local_data <- TRUE\n  local_datapath = \"02_data\"\n\n # random sample only\n  random_sample <- FALSE\n  \n  # projects list 1\n  projects <- c(\"sante2\", \"education2\", \"transport2\", \"watsan2\", \"agr2\")\n  \n  # projects list 2\n  RAPIDprojects <- c(\"RAPIDhealth\", \"RAPIDeducation\", \"RAPIDtransport\", \"RAPIDwatsan\", \"RAPIDagriculture\", \"RAPIDprivate\")\n\n  # preferred projects list\n  pprojects <- c(\"health\", \"edu\", \"transport\", \"watsan\", \"agri\", \"private\", \"other\")\n  \n  # attitudes list\n  attitudes <- c(\"qg008_women2\",  \"qg009_mistreatment2\", \"qg010_socioadmin2\", \"qg011_women_pres2\", \"attitudes_mfi\")\n  attitudes_labs <- c(\"Same rights\",  \"Complain mistreat\", \"Soc-Admin Pos\", \"Eligible Pres\", \"Mean effects\")\n```\n\n## Get data \nScript to load the study's data from Dataverse (only runs if above \"local_data <- FALSE\").\n```{r, echo = FALSE, eval = TRUE, warning=FALSE}\nsource(\"R/1 getdata.R\")\n```\n\n\n## Prepare variables\n```{r prep, echo = TRUE, warning = FALSE}\nsource(\"R/1 prep.R\")\n```\n\n# Context information (Section 2)\n\nRespondent knows the name of Congo's ruling party:\n```{r, echo = FALSE, warning = FALSE}\n  # Knows name DRC's ruling party\n  party  <- ind[ind$q72_know_party!=\"\",]\n  #100*prop.table(table(party$q72_know_party))\n\n  # table(party$q72_know_party, party$q011_sex)\n  party <- 100*prop.table(table(party$q72_know_party, party$q011_sex)[,4:5],2)\n  colnames(party) =  c(\"Women\", \"Men\")\n  kable(party, digits = 2)\n\n```\n\nRespondent knows the name of Congo's prime minister: \n```{r, echo = FALSE, warning = FALSE}\n\n  # Knows name DRC's PM\n  pmdata  <- ind[ind$q70_know_pm!=\"\",]\n\n  pm <- 100*prop.table(table(pmdata$q70_know_pm))\n\n  #table(pm$q70_know_pm, pm$q011_sex)\n  pm <- 100*prop.table(table(pmdata$q70_know_pm, pmdata$q011_sex)[,4:5],2)\n  colnames(pm) =  c(\"Women\", \"Men\")\n  kable(pm, digits = 2)\n\n```\n\nWho initiated development project (in percentages):\n```{r, echo = FALSE, warning = FALSE}\n  # Who initiates development projects\ntable_who <- round(100*prop.table(table(ind$q46_1h)),3)\ntable_who\n\n\n```\n\n\n## Time allocation on daily activities (Figure 1)\n```{r, warning = FALSE, fig.height= 20, fig.width = 20}\nsource(\"R/Figure_1_Time_Allocation.R\")\ngender_plot\n\npdf(file=\"04_output/fig_timeallocation.pdf\", width=10, height=12)\n  gender_plot  \ndev.off()\n\n```\n\n\n## Project preferences by gender (Table 1) \n\n```{r, echo=FALSE}\nDMC <- filter(DMC, pilot_lottery ==1)\nDMC$cdc_parity_norm <- DMC$cdc_parity - mean(DMC$cdc_parity, na.rm = TRUE) \nDMC$decades <- DMC$av_11_age/10\nDMC$female_parity <- DMC$female*DMC$cdc_parity\nprefs_table <- \n  sapply(pprojects, function(k) {\n    output_function(lm_cluster_robust(paste(k, \"~ female+ decades +  as.factor(lott_bin)\"), \n                                      data = DMC, \n                                      cluster_name = \"CDCCODE\"), coefrows=2:3)})\n\n## Controls means in\nmeans <-  apply(filter(DMC, female==0)[, pprojects], 2, mean, na.rm=TRUE)\nprefs_table <-rbind(prefs_table[1:2,], round(means,3), prefs_table[nrow(prefs_table),])\n\nprint(prefs_table)\n```\n\n```{r, echo = FALSE}\nT7 <- rbind(\n  \"\\\\begin{tabular}{lcccccc}\",\n  \"\t&\tHealth\t&\tEdu. \t    &\tTransport\t  \t&\tWatsan  &\tAgric. & Private\t \\\\\\\\ \\\\hline \\\\hline\",\n\n  mat_to_tex(prefs_table[,-7], rownames = c(\"Difference for women\", \"(se)\", \"Men\", \"N\")) ,\n  \"\\\\hline \\\\hline \\\\mc{7}{l}{\\\\parbox{5in}{\\\\small\\\\singlespace  \n  \\\\textit{Notes:} Differences in preferences by gender. We report sample average treatment effects. Regressions using lottery bin fixed effects. Standard errors clustered at CDC level. Based on question AV14. $* p \\\\le 0.10, ** p \\\\le 0.05, *** p \\\\le  0.01$.}\n  }\",\n  \"\\\\label{tab:RAPIDpreferences}\",\n  \"\\\\end{tabular}\"\n)\n\nsink(\"04_output/Table_RAPIDpreferences.tex\")\ntablr(T7)\nsink()\n\n```\n\n## Position in the village (in text)\n\nPresence at a village meeting:\n```{r, echo=FALSE}\n  presdata <- dplyr::filter(ind, !is.na(q079_a_meeting))\n  presdata <- dplyr::filter(presdata, q079_a_meeting!=\"doesn't know\")\n  pres <- 100*prop.table(table(presdata$q079_a_meeting, presdata$q011_sex)[,4:5],2)\n  colnames(pres) =  c(\"Women\", \"Men\")\n  kable(pres, digits = 2)\n  \n  presdata$female <- 1* (presdata$q011_sex == \"yes\")\n  presdata$q079_a_meeting <- 1* (presdata$q079_a_meeting == \"yes\")\n  n <- length(presdata$q079_a_meeting)\n  M <- lm(q079_a_meeting~female + as.factor(lott_bin), data = presdata, na.action=\"na.exclude\")\n  c(cluster_robust(M, presdata$IDV_CDCCODE)[[1]][2,], N = n)\n\n  \n```\n\nParticipated in last village meeting:\n```{r, echo = FALSE}\n\n  discdata <- dplyr::filter(ind, !is.na(q079_b_discours))\n  discdata <- dplyr::filter(discdata, q079_b_discours!=\"not applicable\")\n  disc <- 100*prop.table(table(discdata$q079_b_discours, discdata$q011_sex)[,4:5],2)\n  colnames(disc) =  c(\"Women\", \"Men\")\n  kable(disc, digits = 2)\n  \n## note\n  \n  discdata$female <- 1* (discdata$q011_sex == \"yes\")\n  discdata$q079_b_discours <- 1* (discdata$q079_b_discours == \"yes\")\n  n <- length(discdata$q079_b_discours)\n  M <- lm(q079_b_discours~female + as.factor(lott_bin), data = discdata, na.action=\"na.exclude\")\n  c(cluster_robust(M, discdata$IDV_CDCCODE)[[1]][2,], N = n)\n  \n```    \n\n\n## Attitudes towards women by gender (Table 2)\n\n```{r, echo = FALSE}\n\n  attitudes_data$female <- 1* (attitudes_data$q011_sex == \"no\")\n  #table(attitudes_data$female, attitudes_data$q011_sex) \n\n  genderattit <- 100*prop.table(table(attitudes_data$qg008_women2, attitudes_data$female),2)\n  colnames(genderattit) =  c(\"Women\", \"Men\")\n  kable(genderattit, digits = 2)\n  \n# Macartan: this should work but it doesnt. Arrgh! Help.\n  \n  #Genderatt <-  sapply(attitudes, function(y) {\n  #M<-lm(`y`~female + as.factor(lott_bin), data = attitudes_data, na.action=\"na.exclude\")\n  #c(cluster_robust(M, attitudes_data$IDV_CDCCODE)[[1]][2,])\n  #})\n  #kable(Genderatt, digits = 3)\n\n  # So for now individually:\n  \n  M<-lm(qg008_women2~female + as.factor(lott_bin), data = attitudes_data, na.action=\"na.exclude\")\n  c(cluster_robust(M, attitudes_data$IDV_CDCCODE)[[1]][2,])\n\n  M<-lm(qg009_mistreatment2~female + as.factor(lott_bin), data = attitudes_data, na.action=\"na.exclude\")\n  c(cluster_robust(M, attitudes_data$IDV_CDCCODE)[[1]][2,])\n\n  M<-lm(qg010_socioadmin2~female + as.factor(lott_bin), data = attitudes_data, na.action=\"na.exclude\")\n  c(cluster_robust(M, attitudes_data$IDV_CDCCODE)[[1]][2,])\n\n  M<-lm(qg011_women_pres2~female + as.factor(lott_bin), data = attitudes_data, na.action=\"na.exclude\")\n  c(cluster_robust(M, attitudes_data$IDV_CDCCODE)[[1]][2,])\n\n  M<-lm(attitudes_mfi~female + as.factor(lott_bin), data = attitudes_data, na.action=\"na.exclude\")\n  c(cluster_robust(M, attitudes_data$IDV_CDCCODE)[[1]][2,])\n    \n```\n\n## Perceptions of chief (in text)\n\nChief should do beneficiary selection:\n```{r}\n\n  respontab <- 100*prop.table(table(ind$qd002_must_be1, ind$q011_sex)[,4:5],2   )\n  colnames(respontab) =  c(\"Women\", \"Men\")\n  kable(respontab, digits = 2)\n\n```\n\nWho should manage $1000 project:\n```{r, echo=FALSE}\n\n  respontab <- 100*prop.table(table(ind$q064_who_decides, ind$q011_sex)[,4:5],2   )\n  colnames(respontab) =  c(\"Women\", \"Men\")\n  kable(respontab, digits = 2)\n\n```\n\n\n# Lottery information and manipulation check (Section 3) \n\n## Lottery information (Table 3)\nInformation about block and cluster structure. Table showing the number of clusters in each of the 43 blocks (in rows) and the number of cluster in the parity condition (in columns) according to project data.\n```{r, echo=FALSE}\ncollapsed  <- Lottery %>%\n                       dplyr::select(lott_bin, pilot_lottery, cdc_parity)%>%\n                        dplyr::filter(pilot_lottery==1) %>%\n                          group_by(lott_bin) %>%\n                            summarise(share = sum(cdc_parity), size = length(cdc_parity))%>%\n                              as.data.frame%>%\n                                dplyr::select(-lott_bin)%>% \n                                 table\n\nkable(t(collapsed))\n```\n\n```{r export}\n\ntabcap = \"Table showing the number of clusters in each of  the 43 blocks (in rows) and the number of cluster in the parity condition according to project data.\"\n\nxt <- xtable(t(collapsed), \n             caption = tabcap,\n             caption.placement = \"top\",\n             table.placement = \"h!\", \n             label = \"tab:bins\")\nfileConn<-file(\"04_output/Table_bins.tex\")\n writeLines(print(xt, comment = FALSE), fileConn)\nclose(fileConn)\n\n```\n\n\n## Manipulation Checks\nBased on research data (used in the text), and project data (used as robustness test): \n```{r FirstStage, echo=FALSE, warning = FALSE}\n# First Stage\n\n  # overlap project (cdv_parity) and research (cdc_parity) data. To report in text\n  fs <- dplyr::filter(IRC_tracking, pilot_lottery==1)\n  100*prop.table(table(fs$cdv_parity, fs$cdc_parity),2)    \n\n  # research data\n  lm_cluster_robust(\"femmes~cdc_parity\", IRC_tracking[IRC_tracking$pilot_lottery==1,], \"IDV_CDCCODE\")\n\n\n  # project data\n  lm_cluster_robust(\"femmes~cdv_parity\", IRC_tracking[IRC_tracking$pilot_lottery==1,], \"IDV_CDCCODE\")[[1]]\n\n\n```\n\n\n# Core Tables plus robustness checks (Section 5)\n\nWe have four core tables on Tuungane project choice, RAPID project choice, behavior and attitudes. We replicate all four tables and with each one provide two robustness results, one using project rather than research team coding on treatment, and the other reporting a LATE analysis with research data (assignment) instrumenting for project data (implementation).\n\n## Tuungane Project Choice (Table 5)\n\nReplicate Table 5 on the effects of the parity requirement:\n```{r}\nsource(\"R/Table_5_Tuungane_Project.R\")\nkable(project_choice_main)\n```\n\n### Robustness test: using project coding\nRobustness test, substituting project data for research data:\n```{r, echo=FALSE}\ncolnames(project_choice_robust) <- c(\"Health\", \"Education\", \"Transport\", \"Watsan\", \"Agriculture\")\nrownames(project_choice_robust) <- c(\"Parity Effect\", \"(se)\", \"Control\", \"N\")\nkable(project_choice_robust)\n```\n\n```{r, include = FALSE}\ncomm <- \"\\\\multicolumn{6}{p{12cm}}{Notes: Effect of parity requirement. Data reported for VDCs that participated in the parity lottery. We report sample average treatment effects. Regressions using lottery bin fixed effects. Standard errors clustered at CDC level. Based on implementing partner's project data and includes villages that were and were not surveyed by the research teams.  $* p \\\\le 0.10, ** p \\\\le 0.05, *** p\\\\le  0.01$.}\"\n\nfileConn<-file(\"04_output/Table_rob1.tex\")\n writeLines(print.xtable(\n     xtable(\n            project_choice_robust, \n            caption = \"Effect of Parity Requirement - Based on Project Data\"),\n    add.to.row = list(pos = list(4), command = comm), \n    comment = FALSE,\n    hline.after=c(-1, 0),\n    table.placement = \"h!\",\n    caption.placement = \"top\"), \n  fileConn)\nclose(fileConn)\n```\n\n### Robustness test: LATE analysis\nWe conduct a LATE analysis by treating the research project records of where parity ought to have been imposed with project records of where in fact it was imposed. There is relatively small non compliance and a very strong first stage. The fragment below reports the local average treatment effect for each project.\n```{r, echo=FALSE} \n# LATE for all the Tuungane Project Choices\nD <- IRC_tracking[c(projects, \"pilot_lottery\", \"cdc_parity\", \"cdv_parity\", \"lott_bin\", \"IDV_CDCCODE\")]\nD <- D[complete.cases(D),]\n\nlate_T <- sapply(projects, function(y) {\nD$Y <- as.vector(unlist(D[y]))\nM <- ivreg(Y~cdv_parity + as.factor(lott_bin) | cdc_parity + as.factor(lott_bin), data = D, na.action=\"na.exclude\")\n cluster_robust(M, D$IDV_CDCCODE)[[1]][2,]\n })\nkable(late_T, digits = 2)\n```\n\n### Additional statistic on omnibus result\nTo run an omnibus test for the null hypothesis that the choices were the  same in parity and nonparity areas we code a variable ``choice`` that takes on a different value for each sector and takes on distinct values. There is a complication in that some areas chose projects in mukiple sectors; to take account of this we create a distinct category for \"mixed\", which we further refine to \"mixed including education\"  and \"mixed other\". In all we have seven categories to which we apply a $\\chi^2$  test. \n```{r multinomial2, echo=FALSE}\nIRC_tracking$choice <- NA\nfor(j in 1:length(projects)){\n  x <- IRC_tracking[projects[j]]\n  IRC_tracking$choice[x ==1] <- j\n  IRC_tracking$choice[x>0 & x<1]   <- -2\n}\nIRC_tracking$choice[IRC_tracking$education2 > 0 & IRC_tracking$education2 < 1]  <- -1\n\nproj_table <- table(IRC_tracking$choice, IRC_tracking$cdc_parity)\nrownames(proj_table) <- c(\"Residual category\", \"Mixed incl education\" , projects)\nkable(proj_table, col.names = c(\"Non-parity\", \"parity\"))\n\nprint(chisq.test(table(IRC_tracking$choice, IRC_tracking$cdc_parity)))\n\nprint(chisq.test(table(IRC_tracking$choice, IRC_tracking$cdv_parity)))\n\n```\n\nWe fail to reject the null that the distribution across these seven categories is different in treatment and control ($p$ = `r chisq.test(table(IRC_tracking$choice, IRC_tracking$cdc_parity))[3]`). Using the project report of where parity was implemented (project data) we have a lower $p$ value of $p$ = `r chisq.test(table(IRC_tracking$choice, IRC_tracking$cdv_parity))[3]`.\n\n\n## RAPID project choice (Table 6)\nReplicate Table 6 on the effects of the parity requirement:\n```{r}\nsource(\"R/Table_6_Rapid_Project.R\")\nkable(project_choice_rapid)\n```\n\n### Robustness test: using project coding\nRobustness test, substituting project data for research data:\n```{r}\nkable(project_choice_rapid_project)\n```\n\n```{r, include = FALSE}\ncomm <- \"\\\\multicolumn{6}{p{12cm}}{Notes: Effect of parity requirement using Project reporting on treatment assignment. Data reported for VDCs that participated in the parity lottery. We report sample average treatment effects. Regressions using lottery bin fixed effects. Standard errors clustered at CDC level. $* p \\\\le 0.10, ** p \\\\le 0.05, *** p\\\\le  0.01$.}\"\n\nfileConn<-file(\"04_output/Table_rob2.tex\")\n writeLines(print.xtable(\n     xtable(\n            project_choice_rapid_project, \n            caption = \"Downstream Effect on RAPID choice (Project assignment data)\",\n            label = \"tab:rob2\"),\n    add.to.row = list(pos = list(3), command = comm), \n    comment = FALSE,\n    hline.after=c(-1, 0),\n    table.placement = \"h!\",\n    caption.placement = \"top\"), \n  fileConn)\nclose(fileConn)\n```\n\n### Robustness test: LATE analysis\nLATE analysis again done using IV on all outcome variables where researcher lottery data is an instrument for the implementation recording on committee structure.\n```{r RAPID_LATE, echo=FALSE}\nD <- rapid_projects[rapid_projects$pilot_lottery==1,][c(RAPIDprojects,  \"cdc_parity\", \"cdv_parity\", \"lott_bin\", \"IDV_CDCCODE\")]\n\n D <- D[complete.cases(D),]\n \n late_R <- sapply(RAPIDprojects, function(y) {\n D$Y <- as.vector(unlist(D[y]))\n M <- ivreg(Y~cdv_parity + as.factor(lott_bin) | cdc_parity + as.factor(lott_bin), data = D, na.action=\"na.exclude\")\n c(cluster_robust(M, D$IDV_CDCCODE)[[1]][2,], N = nrow(D))\n })\nkable(late_R, digits = 2)\n```\n\n### Additional statistic on omnibus result\n\n```{r multinomial, echo=FALSE}\nrapid_projects$choice <- NA\nfor(j in 1:length(RAPIDprojects)){\n  x <- rapid_projects[RAPIDprojects[j]]\n  rapid_projects$choice[x ==1] <- j\n}\n\nrproj_table <- table(rapid_projects$choice, rapid_projects$cdc_parity)\nrownames(rproj_table) <- c(RAPIDprojects)\nkable(rproj_table, col.names = c(\"Non-parity\", \"parity\"))\n\nprint(chisq.test(table(rapid_projects$choice, rapid_projects$cdc_parity)))\n\nprint(chisq.test(table(rapid_projects$choice, rapid_projects$cdv_parity)))\n\n```\n\n## Other Behavioral Results Based on RAPID (Table 7)\n\nReplicate Table 7 on the effects of the parity requirement:\n```{r}\nsource(\"R/Table_7_Other_Behavioral.R\")\nT4B <- cbind(present, interventions, composition)\nrownames(T4B) <- c(\"Effect\", \"se\", \"Control mean\", \"N\")\nkable(T4B)\n```\n\n\n### Robustness test: using project coding\nRobustness test, substituting project data for research data:\n```{r BehRob}\npresent2 <-\n  output_function(lm_cluster_robust(paste(\"sharewomenA~cdv_parity  + as.factor(lott_bin)\"), \n                                    data = meetings_gender, \n                                    cluster_name = \"IDV_CDCCODE\"), coefrows=2)\ninterventions2 <-\n  output_function(lm_cluster_robust(paste(\"female~cdv_parity  + as.factor(lott_bin)\"), \n                                    data = discussion_gender_village, \n                                    cluster_name = \"IDV_CDCCODE\"), coefrows=2)\ncomposition2 <-\n  output_function(lm_cluster_robust(paste(\"share_women~cdv_parity  + as.factor(lott_bin)\"), \n                                    data = committee_gender, \n                                    cluster_name = \"IDV_CDCCODE\"), coefrows=2)\n\nout <- cbind(present2, interventions2, composition2)\ncolnames(out) <- c(\"Were Present\", \"Spoke\", \"Were on committee\")\nkable(out)\n```\n\n\n### Robustness test: LATE analysis\nLATE analysis again done using IV on all outcome variables where researcher lottery data is an instrument for the implementation recording on committee structure.\n```{r BehLATE}\npresent2L <-{\n  D <- meetings_gender[c(\"sharewomenA\", \"cdv_parity\", \"cdc_parity\", \"lott_bin\", \"IDV_CDCCODE\")] \n  D <- D[complete.cases(D),]\n  M <- ivreg(sharewomenA ~ cdv_parity + as.factor(lott_bin) | cdc_parity + as.factor(lott_bin),  data = D, na.action=\"na.exclude\")\n  c(cluster_robust(M, D$IDV_CDCCODE)[[1]][2,], N = nrow(D))\n}\n\ninterventions2L <-{\n  D <- discussion_gender_village[c(\"female\", \"cdv_parity\", \"cdc_parity\", \"lott_bin\", \"IDV_CDCCODE\")] \n  D <- D[complete.cases(D),]\n  M <- ivreg(female ~ cdv_parity + as.factor(lott_bin) | cdc_parity + as.factor(lott_bin),  data = D, na.action=\"na.exclude\")\n  c(cluster_robust(M, D$IDV_CDCCODE)[[1]][2,], N = nrow(D))\n}\n\ncomposition2L <-{\n  D <- committee_gender[c(\"share_women\", \"cdv_parity\", \"cdc_parity\", \"lott_bin\", \"IDV_CDCCODE\")] \n  D <- D[complete.cases(D),]\n  M <- ivreg(share_women ~ cdv_parity + as.factor(lott_bin) | cdc_parity + as.factor(lott_bin),  data = D, na.action=\"na.exclude\")\n  c(cluster_robust(M, D$IDV_CDCCODE)[[1]][2,], N = nrow(D))\n}\n\noutL <- cbind(present2L, interventions2L, composition2L)\ncolnames(outL) <- c(\"Were Present\", \"Spoke\", \"Were on committee\")\nkable(outL)\n```\n\n\n## Attitudes towards women (Table 8)\n\nReplicate Table 8 on the effects of the parity requirement:\n```{r}\nsource(\"R/Table_8_Attitudes.R\")\nkable(attitudes_table)\n```\n\n### Robustness test: using project coding\nRobustness test, substituting project data for research data:\n```{r}\nattitudes_table <- \n  sapply(attitudes, function(k) {\n    output_function(lm_cluster_robust(paste(k, \"~cdv_parity + as.factor(lott_bin)\"), \n                                      data = attitudes_data, \n                                      cluster_name = \"IDV_CDCCODE\"), coefrows=2)})\nkable(attitudes_table)\n\n```\n\n### Robustness test: LATE analysis\nLATE analysis again done using IV on all outcome variables where researcher lottery data is an instrument for the implementation recording on committee structure.\n```{r, echo=FALSE}\nlate_A <- sapply(attitudes, function(y) {\n    D <- attitudes_data[attitudes_data$pilot_lottery==1,][c(y,  \"cdc_parity\", \"cdv_parity\", \"lott_bin\", \"IDV_CDCCODE\")]\n    D <- D[complete.cases(D),]\n    \n    D$Y <- as.vector(unlist(D[y]))\n    M <- ivreg(Y~cdv_parity + as.factor(lott_bin) | cdc_parity + as.factor(lott_bin), data = D, na.action=\"na.exclude\")\n    c(cluster_robust(M, D$IDV_CDCCODE)[[1]][2,], N = nrow(D))\n    })\n\n colnames(late_A) <- attitudes_labs \n kable(late_A, digits = 2)\n```\n\n\n\n# Balance test (Appendix B)\n\n```{r, warning=FALSE, echo = FALSE}\n\n#################\n# Distance from chiefdom HQ (asked to all respondents during Step D). Target= 200 observations\n#################\n\n  # There are a whole other set that can be used: \n  # qe013_a_water, qe013_b_market, qe013_c_public_transport, qe013_d_prim_school, qe013_e_sec_school, qe013_f_health, qe013_g_pharmacy, qe013_h_clinique, qe013_i_mine, qe013_j_post, qe013_k_chef_chefferie\n  # I tried to loop over these but can't get it to work. Frustratingly\n\n  distchief <- dplyr::filter(ind, pilot_lottery ==1)\n\n  distchief$qe013_a_water_hrs[distchief$qe013_a_water_hrs<0]<-NA\n  distchief$qe013_a_water_mns[distchief$qe013_a_water_mns<0]<-NA\n  distchief$qe013_a_water <- round(distchief$qe013_a_water_hrs+distchief$qe013_a_water_mns/60,2)\n  \n  distchief$qe013_k_chef_chefferie_hrs[distchief$qe013_k_chef_chefferie_hrs<0]<-NA\n  distchief$qe013_k_chef_chefferie_mns[distchief$qe013_k_chef_chefferie_mns<0]<-NA\n  distchief$qe013_k_chef_chefferie <- round(distchief$qe013_k_chef_chefferie_hrs+distchief$qe013_k_chef_chefferie_mns/60,2)\n  \n    disdata <-   aggregate(cbind(qe013_a_water, qe013_k_chef_chefferie, cdc_parity, lott_bin, IDV_CDCCODE) ~ IDV , data = distchief, FUN = mean, na.rm = TRUE)\n  \n  Pm <- mean(disdata$qe013_a_water[disdata$cdc_parity==1])\n  NPm <- mean(disdata$qe013_a_water[disdata$cdc_parity==0])\n  Psd <- sd(disdata$qe013_a_water[disdata$cdc_parity==1])\n  NPsd <- sd(disdata$qe013_a_water[disdata$cdc_parity==0])\n  M <- lm(qe013_a_water~cdc_parity + as.factor(lott_bin), data = disdata, na.action=\"na.exclude\")\n  Table_dis1 <- c(\"Mean Parity\" = Pm, \"SD Parity\" = Psd, \"Mean Nonparity\"= NPm, \"SD Nonparity\"= NPsd,  cluster_robust(M, disdata$IDV_CDCCODE)[[1]][2,c(1,2,4)], N = cluster_robust(M, disdata$IDV_CDCCODE)[[2]][1])\n\n  Pm <- mean(disdata$qe013_k_chef_chefferie[disdata$cdc_parity==1])\n  NPm <- mean(disdata$qe013_k_chef_chefferie[disdata$cdc_parity==0])\n  Psd <- sd(disdata$qe013_k_chef_chefferie[disdata$cdc_parity==1])\n  NPsd <- sd(disdata$qe013_k_chef_chefferie[disdata$cdc_parity==0])\n  M <- lm(qe013_k_chef_chefferie~cdc_parity + as.factor(lott_bin), data = disdata, na.action=\"na.exclude\")\n  Table_dis2 <- c(\"Mean Parity\" = Pm, \"SD Parity\" = Psd, \"Mean Nonparity\"= NPm, \"SD Nonparity\"= NPsd,  cluster_robust(M, disdata$IDV_CDCCODE)[[1]][2,c(1,2,4)], N = cluster_robust(M, disdata$IDV_CDCCODE)[[2]][1])\n\n\n#################\n# Infrastructure in 2006 (asked to chief only during Step D). Target= 200 observations\n#################\n\n  # There are a whole other set that can be used: \n\t# cq023_a1_wells_2006 cq024_a1_schools_2006 cq025_a1_cliniques_2006 cq026_a1_churches_2006 cq027_a1_halls_2006\n  # I tried to loop over these but can't get it to work. Frustratingly\n\n  infra <- merge(vill_data, Lottery, all = TRUE, by = \"IDV_CDCCODE\")\n  infra <- dplyr::filter(infra, pilot_lottery ==1)\n  nrow(infra)\n\n  infra$cq023_a1_wells_2006[infra$cq023_a1_wells_2006<0] <- NA\n  Pm <- mean(infra$cq023_a1_wells_2006[infra$cdc_parity==1], na.rm=TRUE)\n  NPm <- mean(infra$cq023_a1_wells_2006[infra$cdc_parity==0], na.rm=TRUE)\n  Psd <- sd(infra$cq023_a1_wells_2006[infra$cdc_parity==1], na.rm=TRUE)\n  NPsd <- sd(infra$cq023_a1_wells_2006[infra$cdc_parity==0], na.rm=TRUE)\n  M <- lm(cq023_a1_wells_2006~cdc_parity + as.factor(lott_bin), data = infra, na.action=\"na.exclude\")\n  Table_infra1 <- c(\"Mean Parity\" = Pm, \"SD Parity\" = Psd, \"Mean Nonparity\"= NPm, \"SD Nonparity\"= NPsd,  cluster_robust(M, infra$IDV_CDCCODE)[[1]][2,c(1,2,4)], N = cluster_robust(M, infra$IDV_CDCCODE)[[2]][1])\n  \n  infra$cq024_a1_schools_2006[infra$cq024_a1_schools_2006<0] <- NA\n  Pm <- mean(infra$cq024_a1_schools_2006[infra$cdc_parity==1], na.rm=TRUE)\n  NPm <- mean(infra$cq024_a1_schools_2006[infra$cdc_parity==0], na.rm=TRUE)\n  Psd <- sd(infra$cq024_a1_schools_2006[infra$cdc_parity==1], na.rm=TRUE)\n  NPsd <- sd(infra$cq024_a1_schools_2006[infra$cdc_parity==0], na.rm=TRUE)\n  M <- lm(cq024_a1_schools_2006~cdc_parity + as.factor(lott_bin), data = infra, na.action=\"na.exclude\")\n  Table_infra2 <- c(\"Mean Parity\" = Pm, \"SD Parity\" = Psd, \"Mean Nonparity\"= NPm, \"SD Nonparity\"= NPsd,  cluster_robust(M, infra$IDV_CDCCODE)[[1]][2,c(1,2,4)], N = cluster_robust(M, infra$IDV_CDCCODE)[[2]][1])\n\n#################\n# Migration into the village in 2006 (asked to chief only during Step D). Target= 200 observations\n#################\n\n  # Let's do this over each individually\n  # cq0136_idp_2006 cq0137_idp_returned_2006 cq0138_refugie_2006 cq0139_refugie_repat_2006\n\n\n#################\n# Existence comittee or association in 2006 (asked to chief only during Step D). Target= 200 observations\n#################\n\t  \n\t# q5362_c_committee_since1-q5362_c_committee_since11\n\n#################\n# Gender (asked to roster during Step D). Target= 97*5 + 103*10=1515 observations\n#################\n        \n\t# qf007_gender\n\n#################\n# Age (asked to roster during Step D). Target= 97*5 + 103*10=1515 observations\n#################\n  \n\t# qf009_birthyear\n\t# 2011-qf009_birthyear\n\n  \n#################\n## bring all together \n#################\n\nBalance <- rbind(Table_dis1, Table_dis2, Table_infra1, Table_infra2)\nrownames(Balance) <- c(\"Distance Wells\", \"Distance Chief HQ\", \"Wells in 2006\", \"Prim Schools in 2006\")\nkable(Balance, dig=2)\n        \n\n```\n\n# Attrition analysis (Appendix C)\nWe show missing data for all measures in the result tables, and check whether missingness is related to parity status.\n\nTuungane project choice:\n```{r, echo=FALSE}\n\n# Target 661, but 7 missing\n\nT_missing <- sapply(projects, function(y) {\n  D <- IRC_tracking[IRC_tracking$pilot_lottery==1,]\n  D$missing <- is.na(D[y])\n  M <- lm(missing~cdc_parity + as.factor(lott_bin), data = D, na.action=\"na.exclude\")\n  c(N_missing = sum(D$missing) , cluster_robust(M, IRC_tracking$IDV_CDCCODE)[[1]][2,])\n })\n\nkable(T_missing, digits = 3)\n```\n\nNext, we look at RAPID project choice:\n```{r, echo=FALSE}\n\n# RAPID project choice: based on step B. \n# Target =149. Only 105 with data\n\nR_missing <- sapply(RAPIDprojects, function(y) {\n  D <- rapid_projects[rapid_projects$pilot_lottery==1 & rapid_projects$IDV_RAPID==1,]\n  D$missing <- is.na(D[y])\n  M <- lm(missing~cdc_parity + as.factor(lott_bin), data = D, na.action=\"na.exclude\")\n  c(N_missing = sum(D$missing) , cluster_robust(M, D$IDV_CDCCODE)[[1]][2,])\n })\n\nkable(R_missing, digits = 3)\n\n```\n\nNext, we look at RAPID behavior:\n```{r, echo=FALSE}\n# RAPID behavior: based on step A/B. \n# Target =149. Only 105 with data (for 1 indicator we drop an outlier so 104)\n# can't be looped, bc come from separate datasets\n\n  # women present\n  D <- meetings_gender[meetings_gender$IDV_RAPID==1,]\n  D$missing <- 1*is.na(D$sharewomenA)\n  M <- lm(missing~cdc_parity + as.factor(lott_bin), data = D, na.action=\"na.exclude\")\n  miss1 <- c(N_missing = sum(D$missing) , cluster_robust(M, D$IDV_CDCCODE)[[1]][2,])\n\n    # women participation\n  D <- dplyr::filter(discussion_gender_village, IDV_RAPID==1 & !is.na(IDV_RAPID))\n  D$missing <- 1*is.na(D$female)\n  M <- lm(missing~cdc_parity + as.factor(lott_bin), data = D, na.action=\"na.exclude\")\n  miss2 <- c(N_missing = sum(D$missing) , cluster_robust(M, D$IDV_CDCCODE)[[1]][2,])\n\n  # composition  \n\n  D <- dplyr::filter(committee_gender, IDV_RAPID==1 & !is.na(IDV_RAPID))\n  D$missing <- 1*is.nan(D$share_women)\n  M <- lm(missing~cdc_parity + as.factor(lott_bin), data = D, na.action=\"na.exclude\")\n  miss3 <- c(N_missing = sum(D$missing) , cluster_robust(M, D$IDV_CDCCODE)[[1]][2,])\n\n  \n  miss <- cbind(miss1, miss2, miss3)\n  rownames(miss) <- c(\"N\", \"est\", \"se\", \"t\", \"p\")\n  colnames(miss) <- c(\"Women present\", \"Women's spoke\", \"were on committee\")\n  kable(miss)\n  \n```\n\nFinally, we look at attitudes:\n```{r, echo=FALSE}\n\n# Attitudes. Target 1490. Only in the 900s observations.\n\nattitudes2 <- c(\"qg008_women2\", \"qg009_mistreatment2\", \"qg010_socioadmin2\", \"qg011_women_pres2\")\n\nAtts <- sapply(attitudes2, function(y) {\n  \n  D <- attitudes_data\n  D$missing <- is.na(D[y])\n  M <- lm(missing~cdc_parity + as.factor(lott_bin), data = D, na.action=\"na.exclude\")\n  c(N_missing = sum(D$missing) , cluster_robust(M, D$IDV_CDCCODE)[[1]][2,])\n })\n\nkable(Atts, digits = 3)\n\n```\n\n# Composition of committees in Tuungane (Appendix D)\n```{r, echo = FALSE}\npar(mfrow = c(2,2))\nwith(IRC_tracking, {\n  hist(femmes[pilot_lottery==1 & cdc_parity==0], main = \"Nonparity villages, Research Data\", breaks = ((0:10) - .5), labels = 0:10, xlim = c(0,10), ylim = c(0,350), xlab = \"Number of women\")\n  hist(femmes[pilot_lottery==1 & cdc_parity==1], main = \"Parity villages, Research Data\", breaks = ((0:10) - .5), labels = 0:10, xlim = c(0,10), ylim = c(0,350), xlab = \"Number of women\")\n  hist(femmes[pilot_lottery==1 & cdv_parity==0], main = \"Nonparity villages, Project Data\", breaks = ((0:10) - .5), labels = 0:10, xlim = c(0,10), ylim = c(0,350), xlab = \"Number of women\")\n  hist(femmes[pilot_lottery==1 & cdv_parity==1], main = \"Parity villages, Project Data\", breaks = ((0:10) - .5), labels = 0:10, xlim = c(0,10), ylim = c(0,350), xlab = \"Number of women\")\n  })\n\ncomposition <-  recordPlot()\n\npdf(file=\"04_output/fig_composition.pdf\", width=10, height=8)\n  composition  \ndev.off()\n```\n\n# Additional analysis on RAPID project preferences (Appendix F)\n\n```{r}\n\nsource(\"R/Table_extra_male_dominance.R\")\nkable(male_dominance, rownames = c(\"Parity Condition\", \"(se)\", \"Male\", \"(se)\", \"Interaction\", \"(se)\", \"N\"))\n```\n",
    "created" : 1493847027620.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3815417205",
    "id" : "6A37E768",
    "lastKnownWriteTime" : 1493872732,
    "last_content_update" : 1493872732,
    "path" : "C:/Dropbox/DRC/08 Writing/6 Gender Parity/Replication.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}